language: java
jdk: oraclejdk8
cache:
  directories:
  - $HOME/.m2

before_deploy:
  - .travis/setup_gpg.sh

deploy:
  provider: releases
  api_key: ${GITHUB_OAUTH_TOKEN}
  file:
    - epsilon-runtime-utils/target/epsilon-runtime-utils-$project_version.jar
    - epsilon-runtime-executable/target/epsilon-runtime-executable-$project_version.jar
  skip_cleanup: true
  on:
    repo: BlackBeltTechnology/epsilon-runtime
    name: v$PROJECT_VERSION

install:
  - export POJECT_BUILD_NUMBER=$(printf "%05d" $TRAVIS_BUILD_NUMBER)
  - export PROJECT_VERSION=$(mvn help:evaluate -N -Dexpression=project.version | grep -v '\[' | sed 's/-SNAPSHOT/-b$PROJECT_BUILD_NUMBER/')
  - mvn versions:set -DnewVersion=$PROJECT_VERSION -f ./epsilon-runtime-parent/pom.xml
  - mvn versions:set -DnewVersion=$PROJECT_VERSIONs
  - echo "Run Install"
  - mvn --settings .maven.xml install -DskipTests=true -Dgpg.skip -Dmaven.javadoc.skip=true 

script: 
  - echo "Run script"
  - mvn clean deploy --settings .maven.xml -DskipTests=true -P release
